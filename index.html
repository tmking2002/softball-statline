<!DOCTYPE html>
<html>
    <head>
        <title>Softball Statline</title>
        <link rel="icon" type = image/png href="logo_small.png">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Get comprehensive game stats for NCAA Softball D1, D2, and D3. Analyze player performances and team statistics with Softball Statline.">
        <meta name="keywords" content="NCAA Softball, Softball Stats, D1, D2, D3, College Softball, Softball Game Statistics, Player Performance Metrics, Softball Teams, Softball Scores, Softball Analysis, Softball Highlights, NCAA Softball Rankings, Softball Records, Softball Season, Softball Standings">
        <meta property="og:title" content="Softball Statline - NCAA Softball Stats">
        <meta property="og:description" content="Get comprehensive game stats for NCAA Softball D1, D2, and D3. Analyze player performances and team statistics with Softball Statline.">
        <meta property="og:image" content="logo.png">
        <meta property="og:url" content="https://softballstatline.com">
        <meta name="twitter:card" content="logo.png">
        
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-red.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <link rel="stylesheet" href="stylesheet.css">

        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

        
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YFFKCYZJXV"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-YFFKCYZJXV');
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                fetch('homepage_header.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('header-container').innerHTML = data;
                    });
            })
        </script>

        <script src="toggle_darkmode.js"></script>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8754067983414109" crossorigin="anonymous"></script>

    </head>
    <body>

          <div id="header-container"></div>

          <div class="w3-card w3-container homepage-container">
            <h3 style="text-align: center; font-weight: bold;">Schedule</h3><br>

            <div class="date-input-container" style="text-align: center;">
                <input type="date" class="dateInput" id="dateInput" name="dateInput" value="2023-06-08" min="2016-02-11" max="2023-06-08" onchange="createDataTable_d1(this.value); createDataTable_d2(this.value); createDataTable_d3(this.value);">
            </div>
          
            <div class="w3-bar" style="text-align: center;">
                <button class="w3-bar-item w3-button testbtn w3-padding-16" style="font-weight: bold;" onclick="openSchedule(event,'D1-schedule')">D1</button>
                <button class="w3-bar-item w3-button testbtn w3-padding-16" style="font-weight: bold;" onclick="openSchedule(event,'D2-schedule')">D2</button>
                <button class="w3-bar-item w3-button testbtn w3-padding-16" style="font-weight: bold;" onclick="openSchedule(event,'D3-schedule')">D3</button>
            </div>

            <p><span id="dateOutput"></span></p>

            <div id="D1-schedule" class="w3-container city w3-animate-opacity">
              <div id="schedule-container-d1" class="homepage-table"></div>
            </div>

            <div id="D2-schedule" class="w3-container city w3-animate-opacity">
              <div id="schedule-container-d2" class="homepage-table"></div>
            </div>

            <div id="D3-schedule" class="w3-container city w3-animate-opacity">
              <div id="schedule-container-d3" class="homepage-table"></div>
            </div>
        </div>

        <div class="w3-card w3-container homepage-container">
            <h3 style="text-align: center; font-weight: bold;">Current RPI Rankings</h3><br>
            <div class="w3-bar">
                <button class="w3-bar-item w3-button testbtn w3-padding-16" style="font-weight: bold;" onclick="openRPI(event,'D1-rpi')">D1</button>
                <button class="w3-bar-item w3-button testbtn w3-padding-16" style="font-weight: bold;" onclick="openRPI(event,'D2-rpi')">D2</button>
                <button class="w3-bar-item w3-button testbtn w3-padding-16" style="font-weight: bold;" onclick="openRPI(event,'D3-rpi')">D3</button>
            </div>

            <div id="D1-rpi">
                <div id="rpi-container-d1" class="homepage-table"></div>
            </div>

            <div id="D2-rpi">
                <div id="rpi-container-d2" class="homepage-table"></div>
            </div>

            <div id="D3-rpi">
                <div id="rpi-container-d3" class="homepage-table"></div>
            </div>
        </div>

        <div class="w3-card w3-container homepage-container" style="height: 500px !important">
            <h3 style="text-align: center; font-weight: bold;">Conference Standings</h3><br>
          <div id="conf-name" style="font-size: 20px; font-weight: bold; text-align: center;"></div>
          <div class="w3-dropdown-hover" style="display: flex; justify-content: center;">
            <p>Select Conference <i class="fa fa-caret-down"></i></p>
            <div class="w3-dropdown-content w3-bar-block scrollable-dropdown" >
                <button class="w3-bar-item w3-button" onclick="openConf(event,'AAC')">AAC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'ACC')">ACC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'America East')">America East</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'ASUN')">ASUN</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Atlantic 10')">Atlantic 10</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Big 12')">Big 12</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Big East')">Big East</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Big Sky')">Big Sky</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Big South')">Big South</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Big Ten')">Big Ten</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Big West')">Big West</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'C-USA')">C-USA</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'CAA')">CAA</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Horizon')">Horizon</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Ivy League')">Ivy League</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'MAAC')">MAAC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'MAC')">MAC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'MEAC')">MEAC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Mountain West')">Mountain West</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'MVC')">MVC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'NEC')">NEC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'OVC')">OVC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Pac-12')">Pac-12</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Patriot')">Patriot</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'SEC')">SEC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'SoCon')">SoCon</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Southland')">Southland</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Summit League')">Summit League</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'Sun Belt')">Sun Belt</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'SWAC')">SWAC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'WAC')">WAC</button>
                <button class="w3-bar-item w3-button" onclick="openConf(event,'WCC')">WCC</button>
            </div>
          </div>
          <div id="conf-standings" style="margin: 1% auto; display: block; width: fit-content;">
          </div>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8754067983414109"
        crossorigin="anonymous"></script>
        <!-- Homepage Sidebar -->
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-8754067983414109"
            data-ad-slot="6493909786"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

        <footer class="w3-container w3-theme-red w3-padding" style="text-align: center; margin-top: 100px !important">
            <p>2024 Softball Statline</p>
            <p><a href="https://twitter.com/SBStatline"><i class="fab fa-twitter"></i></a> Created by Tyson King</p>
        </footer>

        

        <script type="module">

            import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

            const supabaseUrl = 'https://ytirxxclotiueajinlkv.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0aXJ4eGNsb3RpdWVhamlubGt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjUyMzExODEsImV4cCI6MjA0MDgwNzE4MX0.YR--t9YR6gaRUqzGoRGmLz0M9EfxXz68hkT67EJthtU';
            const supabase = createClient(supabaseUrl, supabaseKey);
            
            // store todays date
            var today = new Date();
            var yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            var dd = yesterday.getDate();
            var mm = yesterday.getMonth()+1; //January is 0 so need to add 1 to make it 1!
            var yyyy = yesterday.getFullYear();
            if(dd<10){
                    dd='0'+dd
                } 
                if(mm<10){
                    mm='0'+mm
                }
            
            yesterday = yyyy+'-'+mm+'-'+dd;

            yesterday = '2023-03-05';

            dateInput.setAttribute('max', yesterday);
            dateInput.setAttribute('value', yesterday);

            let [year, month, day] = yesterday.split('-');

            day = parseInt(day);

            month = parseInt(month);
            
            let formattedDate = `${month}/${day}/${year}`;
            
            formattedDate = '3/5/2023';
            

            // Function to fetch CSV file and create the data table
            // function createDataTable_d1(dateInput) {
            //     fetch('rpi_rankings/d1_rpi.csv')
            //         .then(response => response.text())
            //         .then(data => {
            //             const rows = data.split('\n');
            //             const tableContainer = document.getElementById('rpi-container-d1');
            //             const table = document.createElement('table');

            //             // Create table header
            //             const headerRow = document.createElement('tr');
            //             let headers = rows[0].split(',').slice(0,-1);
            //             headers[0] = "";
            //             headers.forEach(header => {
            //                 const th = document.createElement('th');
            //                 th.textContent = header.toUpperCase();
            //                 headerRow.appendChild(th);
            //             });
            //             table.appendChild(headerRow);

            //             // Create table rows
            //             for (let i = 1; i < rows.length; i++) {
            //                 const row = document.createElement('tr');
            //                 const rowData = rows[i].split(',').slice(0,-1);
                            
            //                 rowData.forEach((cellData, index) => {
            //                 const cell = document.createElement('td');
            //                 let teamID = rows[i].split(',')[3];
                            
            //                 if (index === 1) {
            //                     const teamLink = document.createElement('a');
            //                     teamLink.href = `team_info?teamID=${teamID}`;
            //                     teamLink.textContent = cellData;
            //                     teamLink.classList.add('hover-underline');
            //                     cell.appendChild(teamLink);
            //                 } else {
            //                     cell.textContent = cellData;
            //                 }   

            //                 row.appendChild(cell);
            //                 });

            //                 table.appendChild(row);
            //             }

            //             table.deleteRow(table.rows.length - 1) 
                    
            //             // Add the table to the container
            //             tableContainer.appendChild(table);
            //         })
                
            //     if (dateInput > yesterday) {
            //         dateInput_d1 = yesterday;
            //     } else {
            //         dateInput_d1 = dateInput;
            //     }
            // }


            const tableContainer = document.getElementById('schedule-container-d1');
            tableContainer.innerHTML = '';
            function fetchSchedule(date) {

                supabase
                    .from('games')
                    .select('*')
                    .eq('date', formattedDate)
                    .then(({ data, error }) => {
                        if (error) {
                            console.error('Error fetching games:', error);
                        } else {
                            // Fetch teams data
                            supabase
                                .from('team_seasons')
                                .select('*')
                                .then(({ data: teams, error: teams_error }) => {
                                    if (teams_error) {
                                        console.error('Error fetching teams:', teams_error);
                                    } else {
                                        console.log('Teams data:', teams);

                                        const merged_data = data.map(game => {
                                            const away_team_id = teams.find(team => teams.team_season_id === game.away_team_season_id);
                                            const home_team_id = teams.find(team => teams.team_season_id === game.home_team_season_id);
                                            return {
                                                ...game,
                                                away_team_id: away_team_id,
                                                home_team_id: home_team_id
                                            };
                                        });

                                        console.log('Merged data:', merged_data);
                                        const table = document.createElement('table');

                                        // Create table rows
                                        for (let i = 1; i < data.length - 1; i++) {
                                            console.log(data[i])

                                            console.log(rowData)

                                            const awayScore = parseInt(data[i]['away_score']);
                                            const homeScore = parseInt(data[i]['home_score']);

                                            const gameContainer = document.createElement('div'); // Use div for the container
                                            gameContainer.classList.add('game-container'); // Add the appropriate CSS class

                                            const awayRow = document.createElement('tr'); // Use div for the rows
                                            awayRow.classList.add('team-row'); // Add the appropriate CSS class
                                            
                                            const awayLogoContainer = document.createElement('td');
                                            awayLogoContainer.classList.add('logo-container');
                                            const awayLogo = document.createElement('img');
                                            awayLogo.src = data[i][2].slice(1, -1);
                                            awayLogo.width = 25;
                                            awayLogo.height = 25;
                                            awayLogoContainer.appendChild(awayLogo);

                                            const awayNameContainer = document.createElement('td');
                                            awayNameContainer.classList.add('name-container');
                                            const awayName = document.createElement('a');
                                            awayName.textContent = rowData[0].slice(1, -1);
                                            awayName.href = `team_info?teamID=${rowData[1]}`
                                            awayNameContainer.appendChild(awayName);

                                            const awayRuns = document.createElement('td');
                                            awayRuns.textContent = rowData[3];

                                            const homeRow = document.createElement('tr'); // Use div for the rows
                                            homeRow.classList.add('team-row'); // Add the appropriate CSS class

                                            const homeLogoContainer = document.createElement('td');
                                            homeLogoContainer.classList.add('logo-container');
                                            const homeLogo = document.createElement('img');
                                            homeLogo.src = rowData[6].slice(1, -1);
                                            homeLogo.width = 25;
                                            homeLogo.height = 25;
                                            homeLogoContainer.appendChild(homeLogo);

                                            const homeNameContainer = document.createElement('td');
                                            homeNameContainer.classList.add('name-container');
                                            const homeName = document.createElement('a');
                                            homeName.textContent = rowData[4].slice(1, -1);
                                            homeName.href = `team_info?teamID=${rowData[5]}`
                                            homeNameContainer.appendChild(homeName);

                                            const homeRuns = document.createElement('td');
                                            homeRuns.textContent = rowData[7];
                                            

                                            if (awayScore > homeScore) {
                                                awayName.classList.add('winning-score');
                                                awayRuns.classList.add('winning-score');
                                                homeName.classList.add('losing-score');
                                                homeRuns.classList.add('losing-score');
                                            } else if (homeScore > awayScore) {
                                                homeName.classList.add('winning-score');
                                                homeRuns.classList.add('winning-score');
                                                awayName.classList.add('losing-score');
                                                awayRuns.classList.add('losing-score');
                                            }

                                            awayRow.appendChild(awayLogoContainer);
                                            awayRow.appendChild(awayNameContainer);

                                            homeRow.appendChild(homeLogoContainer);
                                            homeRow.appendChild(homeNameContainer);

                                            awayRow.appendChild(awayRuns);
                                            homeRow.appendChild(homeRuns);

                                            const boxLink = document.createElement('a');
                                            boxLink.textContent = 'Box';
                                            boxLink.href = `game_info?gameID=${rowData[9].slice(1, -1)}&season=${rowData[8].slice(7, -1)}`;

                                            gameContainer.appendChild(awayRow);
                                            gameContainer.appendChild(homeRow);
                                            gameContainer.appendChild(boxLink);

                                            tableContainer.appendChild(gameContainer);
                                        }
                                    }
                                })
                        }
                    })
            
            }
                
            
            fetchSchedule(yesterday);

    
            
            function openSchedule(evt, cityName) {
              var i;
              var x = document.querySelectorAll('[id$="-schedule"]');
              for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
              }
              var activebtn = document.getElementsByClassName("testbtn");
              for (i = 0; i < x.length; i++) {
                activebtn[i].className = activebtn[i].className.replace(" w3-dark-grey", "");
              }
              document.getElementById(cityName).style.display = "block";

              var dateInputValue = document.getElementById("dateInput").value;

              if(cityName === 'D1-schedule' & dateInputValue > yesterday){
                dateInputValue = yesterday;
              } else if (cityName === 'D2-schedule' & dateInputValue > yesterday) {
                dateInputValue = yesterday;
              } else if (cityName === 'D3-schedule' & dateInputValue > yesterday) {
                dateInputValue = yesterday;
              }
            }
            
            function openRPI(evt, cityName) {
              var i;
              var x = document.querySelectorAll('[id$="-rpi"]');
              for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
              }
              var activebtn = document.getElementsByClassName("testbtn");
              for (i = 0; i < x.length; i++) {
                activebtn[i].className = activebtn[i].className.replace(" w3-dark-grey", "");
              }
              document.getElementById(cityName).style.display = "block";
            }
            
            function openConf(evt, confName) {
              fetch(`conf_standings/${confName}.csv`)
                    .then(response => response.text())
                    .then(data => {
                        const rows = data.split('\n');
                        const tableContainer = document.getElementById('conf-standings');
                        const table = document.createElement('table');
                        table.id = 'conf-table';
                        table.classList.add('homepage-table')
                        table.style.display = 'block';
                        table.style.height = 'auto';

                        // Create table header
                        const headerRow = document.createElement('tr');
                        const headers = rows[0].split(',').slice(0,-1);
                        headers.forEach(header => {
                            const th = document.createElement('th');
                            th.textContent = header;
                            headerRow.appendChild(th);
                        });
                        table.appendChild(headerRow);

                        // Create table rows
                        for (let i = 1; i < rows.length; i++) {
                            const row = document.createElement('tr');
                            const rowData = rows[i].split(',').slice(0,-1);
                            
                            rowData.forEach((cellData, index) => {
                            const cell = document.createElement('td');
                            let teamID = rows[i].split(',')[3];
                            
                            if(index !== 3){
                                if (index === 0) {
                                    const teamLink = document.createElement('a');
                                    teamLink.href = `team_info?teamID=${teamID}`;
                                    teamLink.textContent = cellData;
                                    teamLink.classList.add('hover-underline');
                                    cell.appendChild(teamLink);
                                } else {
                                    cell.textContent = cellData;
                                }   
                            }

                            row.appendChild(cell);
                            });

                            table.appendChild(row);
                        }
                  
                        tableContainer.innerHTML = '';

                        table.deleteRow(table.rows.length - 1) 
                    
                        // Add the table to the container
                        tableContainer.appendChild(table);
                  
                        const heading = document.getElementById('conf-name');
                        heading.textContent = confName;
                    })
            }

            openConf(event, 'SEC')
            openSchedule(event, 'D1-schedule')  
            openRPI(event, 'D1-rpi')  
            // createDataTable_d1(yesterday)
            // createDataTable_d2(yesterday)
            // createDataTable_d3(yesterday)
        </script>

    </body>

</html>
